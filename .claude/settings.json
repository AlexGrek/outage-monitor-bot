{
  "permissions": {
    "allow": [
      "Bash(go get:*)",
      "Bash(go mod tidy:*)",
      "Bash(npm install:*)",
      "Bash(curl:*)",
      "Bash(go test:*)",
      "Bash(make docker-build:*)",
      "Bash(helm template:*)",
      "Bash(/Users/vedmedik/dev/tg-monitor-bot/DOCKER.md << 'EOFMARKER'\n# Docker Deployment Guide\n\nThis guide covers building and deploying the Telegram Monitor Bot using Docker.\n\n## Architecture\n\nThe Docker image uses a **multi-stage build** process:\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│ Stage 1: Frontend Builder \\(node:22-alpine\\)                  │\n│ - Install npm dependencies                                   │\n│ - Build React app with Vite                                  │\n│ - Output: /build/frontend/dist                               │\n└─────────────────────────────────────────────────────────────┘\n                          │\n                          ▼\n┌─────────────────────────────────────────────────────────────┐\n│ Stage 2: Backend Builder \\(golang:1.24-alpine\\)               │\n│ - Download Go dependencies                                   │\n│ - Build optimized binary \\(CGO_ENABLED=0\\)                     │\n│ - Output: /build/tg-monitor-bot                              │\n└─────────────────────────────────────────────────────────────┘\n                          │\n                          ▼\n┌─────────────────────────────────────────────────────────────┐\n│ Stage 3: Runtime \\(nginx:1.27-alpine\\)                        │\n│ - Copy backend binary from stage 2                           │\n│ - Copy frontend dist from stage 1                            │\n│ - Install supervisor to run both processes                   │\n│ - Configure nginx to:                                        │\n│   • Serve frontend at /                                      │\n│   • Proxy /api/* to backend at :8080                         │\n│   • Support React Router \\(fallback to index.html\\)            │\n└─────────────────────────────────────────────────────────────┘\n```\n\n### Final Image Contents\n\n- **nginx** - Serves frontend and proxies API requests\n- **backend binary** - Telegram bot + REST API\n- **supervisord** - Process manager for nginx + backend\n- **Frontend assets** - Built React app at `/usr/share/nginx/html`\n- **Data directory** - Persistent storage at `/app/data`\n\n## Quick Start\n\n### Using Docker Compose \\(Recommended\\)\n\n```bash\n# 1. Build and start\ndocker-compose up -d\n\n# 2. View logs\ndocker-compose logs -f\n\n# 3. Stop\ndocker-compose down\n```\n\nAccess the application:\n- **Frontend**: http://localhost:3000\n- **API**: http://localhost:3000/api or http://localhost:8080\n- **Health**: http://localhost:3000/health\n\n### Using Makefile\n\n```bash\n# Build the image\nmake docker-build\n\n# Test locally on port 3000\nmake docker-build-local\n\n# View logs\ndocker logs -f tg-monitor-bot-test\n\n# Stop test container\nmake docker-stop-test\n\n# Run in production mode\nmake docker-run-detached\n\n# View logs\nmake docker-logs\n\n# Stop\nmake docker-stop\n```\n\n## Configuration\n\n### Environment Variables\n\nConfigure via `.env` file or `docker-compose.yml`. See `.env.example` for all available options.\n\nKey variables:\n- `TELEGRAM_TOKEN` - Required bot token from @BotFather\n- `API_KEY` - REST API authentication key\n- `API_PORT` - API server port \\(default: 8080\\)\n- `DB_PATH` - Database file path \\(default: /app/data/state.db\\)\n\n### Persistent Storage\n\nData is stored in `/app/data`. Always mount a volume:\n\n```bash\n-v $\\(pwd\\)/data:/app/data              # Bind mount\n-v tg-monitor-data:/app/data          # Named volume\n```\n\n### Network Capabilities\n\nRequires `NET_RAW` for ICMP ping:\n\n```bash\n--cap-add NET_RAW\n```\n\n## Building\n\n```bash\n# Standard build\nmake docker-build\n\n# With version\nVERSION=v1.2.3 make docker-build\n\n# Multi-platform\ndocker buildx build --platform linux/amd64,linux/arm64 -t tg-monitor-bot:latest .\n```\n\n## Nginx Routing\n\n| Path | Destination | Purpose |\n|------|-------------|---------|\n| `/api/*` | `localhost:8080` | Backend API |\n| `/health` | `localhost:8080/health` | Health check |\n| `/*` | `/usr/share/nginx/html` | Frontend |\n\n## Troubleshooting\n\n### Check logs\n```bash\ndocker logs tg-monitor-bot\n```\n\n### Verify processes\n```bash\ndocker exec tg-monitor-bot ps aux\n```\n\n### Test health\n```bash\ncurl http://localhost:3000/health\n```\n\n## Security\n\n- Runs as non-root user \\(UID 1000\\)\n- Only `NET_RAW` capability required\n- Never commit secrets to image\n\nFor Kubernetes deployment, see [helm/tg-monitor-bot/README.md]\\(helm/tg-monitor-bot/README.md\\)\nEOFMARKER)",
      "Bash(make:*)",
      "Bash(kubectl get:*)",
      "Bash(kubectl describe:*)",
      "Bash(kubectl logs:*)",
      "Bash(git -C /Users/vedmedik/dev/tg-monitor-bot ls-files)",
      "Bash(ls:*)"
    ]
  }
}
